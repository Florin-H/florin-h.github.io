const LocalStorageSupport=IsLocalStorageSupported(),ls=window.localStorage,LocalStorageNotSupported="Your browser does not support saving to local storage...",NAME="name",CNP="cnp",POB="pob",FATHER="father",CONSTANTS_NAMES=[NAME,CNP,POB,FATHER],CharacterType={SYMBOL:0,DIGIT:1,CAPITAL:2,NORMAL:3};var passwordExists,previousProduct;function IsLocalStorageSupported(){return"undefined"!=typeof Storage}function LoadLocalStorage(){if(0==LocalStorageSupport)return UpdateValidationResult(LocalStorageNotSupported),void DisableTheOtherFunctions();Initialize()}function DisableTheOtherFunctions(){document.getElementById("delete-button").disabled=!0,document.getElementById("save-button").disabled=!0,document.getElementById("generate-button").disabled=!0}function Initialize(){CONSTANTS_NAMES.forEach(e=>ls.getItem(e)?document.getElementById(e).value=ls.getItem(e):document.getElementById(e).removeAttribute("readonly")),document.getElementById("product").value=null,document.getElementById("chars-to-ignore").value=null,document.getElementById("iterations").value=null,document.getElementById("password").value=null,document.getElementById("chars-to-ignore").removeAttribute("readonly"),document.getElementById("generate-new-button").disabled=!0,passwordExists=!1,previousProduct=""}function UpdateValidationResult(e="Validation failed."){document.getElementById("validation-result").innerHTML=e,ScrollToTop()}function Validate(){return!(ls.getItem(NAME)&&ls.getItem(CNP)&&ls.getItem(POB)&&ls.getItem(FATHER))}function EmptyValuesExist(e=[]){for(var t=0;t<e.length;t++)if(!document.getElementById(e[t]).value)return!0;return!1}function FlattenProductName(e){return e.replace(/_/g,"").replace(/ /g,"_").replace(/[^a-z0-9_]+/gi,"").toLowerCase()}function SetExclusions(e,t,n){return exclusionsInput=document.getElementById("chars-to-ignore"),n<t?(exclusionsInput.value="NO EXCLUSIONS ALLOWED",exclusionsInput.setAttribute("readonly","true"),!0):e?(exclusionsInput.value=e,exclusionsInput.setAttribute("readonly","true"),!0):(exclusionsInput.getAttribute("readonly")&&(exclusionsInput.value="",exclusionsInput.removeAttribute("readonly")),!1)}function SaveExclusions(e,t,n){ls.setItem(e+"_exclusions",n.value),ls.setItem(e+"_exclusions_start",t),n.setAttribute("readonly","true")}function LoadExistingIterations(e=""){if(!EmptyValuesExist(["product"])){e||(e=FlattenProductName(document.getElementById("product").value));var t=ls.getItem(e+"_iterations");return t||(t=IncreaseIterationsAndSave(e,0)),document.getElementById("iterations").value=t,t}UpdateValidationResult("Product must NOT be empty")}function IncreaseIterationsAndSave(e,t){return ls.setItem(e+"_iterations",Number(t)+1),ls.getItem(e+"_iterations")}function EnableGenerateNewPassword(){document.getElementById("generate-new-button").disabled=!1}function ExcludeSymbols(e=[]){return["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_","`","{","|","}","~"].filter(function(t){return!e.includes(t)})}function ScrollToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function SaveConstants(){1!=EmptyValuesExist(CONSTANTS_NAMES)?CONSTANTS_NAMES.forEach(function(e){ls.setItem(e,document.getElementById(e).value),document.getElementById(e).setAttribute("readonly","true")}):UpdateValidationResult("All constants must be filled in!")}function DeleteConstants(){ls.clear(),CONSTANTS_NAMES.forEach(function(e){document.getElementById(e).value="",document.getElementById(e).removeAttribute("readonly")})}function ToggleVisibility(e,t){var n=document.getElementById(t),o=document.getElementById(e);"password"===n.type?n.type="text":n.type="password","View"===o.innerHTML?o.innerHTML="Hide":o.innerHTML="View"}function GeneratePassword(){if(Validate())UpdateValidationResult("All constants must be filled and saved!");else if(EmptyValuesExist(["product"]))UpdateValidationResult("Product must NOT be empty");else{var e=FlattenProductName(document.getElementById("product").value);if(passwordExists&&previousProduct==e)CopyPassword();else{var t=document.getElementById("chars-to-ignore"),n=LoadExistingIterations(e);!LoadExistingExclusions(e,n)&&t.value&&SaveExclusions(e,n,t);var o=BuildShuffledSymbols(t.value,n),r=BuildShuffledDigits(n),a=BuildShuffledCapitals(n),l=BuildShuffledNormals(n),u=document.getElementById("product").value;for(pwd=BuildPassword(u,16,o,r,a,l);1!=n;)pwd=BuildPassword(pwd,16,o,r,a,l),n--;document.getElementById("password").value=pwd,EnableGenerateNewPassword(),passwordExists=!0,previousProduct=e,CopyPassword(),document.getElementById("export-data").disabled=!1}}}function GenerateNewPassword(){var e=FlattenProductName(document.getElementById("product").value);IncreaseIterationsAndSave(e,LoadExistingIterations(e)),passwordExists=!1,GeneratePassword()}function LoadExistingExclusions(e="",t){if(!EmptyValuesExist(["product"]))return e||(e=FlattenProductName(document.getElementById("product").value)),SetExclusions(ls.getItem(e+"_exclusions"),ls.getItem(e+"_exclusions_start"),t);UpdateValidationResult("Product must NOT be empty")}function CopyPassword(){document.getElementById("password").select(),document.execCommand("copy")}function ExportData(){Download("ABPG_MyInfo.json",GetData())}function GetData(){var e={};for(var t in local=localStorage,local)e[t]=local[t];return e}function Download(e,t){var n=document.createElement("a"),o=JSON.stringify(t);n.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(o)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function LoadDataFromFile(e){var t=e.files[0];if(t)if(ValidateFileType(t)){var n=new FileReader;n.onload=function(e){var t=e.target.result;t=JSON.parse(t),Object.entries(t).forEach(function([e,t]){"length"!=e&&ls.setItem(e,t)})},n.readAsText(t)}else UpdateValidationResult("File must be of type JSON!");else UpdateValidationResult("No files uploaded!")}function ValidateFileType(e){return"application/json"==e.type}function BuildPassword(e,t,n,o,r,a){for(var l=Shuffle(e.split(""),GetArrayOfRandoms(e,e.length)),u=GetArrayOfRandoms(l,t),s=GetSequenceForCharacterTypes(l,n,o,r,t,3),d=[],i=0;i<s.length;i++)switch(s[i]){case CharacterType.SYMBOL:d+=n[GetRandomNumber(u[i],n.length)];break;case CharacterType.DIGIT:d+=o[GetRandomNumber(u[i],o.length)];break;case CharacterType.CAPITAL:d+=r[GetRandomNumber(u[i],r.length)];break;case CharacterType.NORMAL:d+=a[GetRandomNumber(u[i],a.length)]}return d}function GetSequenceForCharacterTypes(e,t,n,o,r,a){var l=GetRandomNumber(t[0],a)+2,u=GetRandomNumber(n[0],a)+2,s=GetRandomNumber(o[0],a)+2,d=r-l-u-s,i=new Array(l).fill(CharacterType.SYMBOL),c=new Array(u).fill(CharacterType.DIGIT),m=new Array(s).fill(CharacterType.CAPITAL),f=new Array(d).fill(CharacterType.NORMAL),p=i.concat(c.concat(m.concat(f)));return p=Shuffle(p,GetArrayOfRandoms(e,r))}function BuildShuffledSymbols(e=[],t){var n=ExcludeSymbols(e),o=ls.getItem(POB).split(""),r=(ls.getItem(FATHER)+ls.getItem(NAME)+ls.getItem(CNP)).split("");r=GetArrayOfRandoms(r,n.length);for(var a=null,l=n;0!=t;)o=a=Shuffle(a=GetArrayOfRandoms(o,l.length),r),l=Shuffle(l,a),t--;return l}function BuildShuffledDigits(e){var t=["0","1","2","3","4","5","6","7","8","9"],n=ls.getItem(FATHER),o=(ls.getItem(POB)+ls.getItem(NAME)+ls.getItem(CNP)).split("");o=GetArrayOfRandoms(o,t.length);for(var r=null,a=t;0!=e;)n=r=Shuffle(r=GetArrayOfRandoms(n,a.length),o),a=Shuffle(a,r),e--;return a}function BuildShuffledCapitals(e){var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n=ls.getItem(NAME),o=(ls.getItem(FATHER)+ls.getItem(POB)+ls.getItem(CNP)).split("");o=GetArrayOfRandoms(o,t.length);for(var r=null,a=t;0!=e;)n=r=Shuffle(r=GetArrayOfRandoms(n,a.length),o),a=Shuffle(a,r),e--;return a}function BuildShuffledNormals(e){var t=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n=ls.getItem(CNP),o=(ls.getItem(FATHER)+ls.getItem(POB)+ls.getItem(NAME)).split("");o=GetArrayOfRandoms(o,t.length);for(var r=null,a=t;0!=e;)n=r=Shuffle(r=GetArrayOfRandoms(n,a.length),o),a=Shuffle(a,r),e--;return a}function GetRandomNumber(e,t=0){return Math.seedrandom(e),0==t?Math.random():Math.floor(Math.random()*Math.floor(t))}function GetArrayOfRandoms(e=[],t,n=0){for(var o=[],r=0;r<e.length;r++)o[r]=GetRandomNumber(e[r],n);for(r=e.length;r<t;r++)o[r]=GetRandomNumber(o[r-e.length],n);return o}function Shuffle(e=[],t=[]){var n,o,r,a=0;for(r=e.length-1;r>0;r--)n=Math.floor(t[a]*(r+1)),o=e[r],e[r]=e[n],e[n]=o,a++;return e}function TestMyCode(e){}Object.freeze(CharacterType),function(e,t,n,o,r,a,l,u,s){var d,i=n.pow(o,6),c=n.pow(2,52),m=2*c,f=o-1,p=n.seedrandom=function(r,a,l){var u=[],s=g(function e(t,n){var o,r=[],a=typeof t;if(n&&"object"==a)for(o in t)try{r.push(e(t[o],n-1))}catch(e){}return r.length?r:"string"==a?t:t+"\0"}((a=1==a?{entropy:!0}:a||{}).entropy?[r,y(t)]:null==r?function(n){try{return d?y(d.randomBytes(o)):(e.crypto.getRandomValues(n=new Uint8Array(o)),y(n))}catch(o){return[+new Date,e,(n=e.navigator)&&n.plugins,e.screen,y(t)]}}():r,3),u),p=new function(e){var t,n=e.length,r=this,a=0,l=r.i=r.j=0,u=r.S=[];n||(e=[n++]);for(;a<o;)u[a]=a++;for(a=0;a<o;a++)u[a]=u[l=f&l+e[a%n]+(t=u[a])],u[l]=t;(r.g=function(e){for(var t,n=0,a=r.i,l=r.j,u=r.S;e--;)t=u[a=f&a+1],n=n*o+u[f&(u[a]=u[l=f&l+t])+(u[l]=t)];return r.i=a,r.j=l,n})(o)}(u);return g(y(p.S),t),(a.pass||l||function(e,t,o){return o?(n.random=e,t):e})(function(){for(var e=p.g(6),t=i,n=0;e<c;)e=(e+n)*o,t*=o,n=p.g(1);for(;e>=m;)e/=2,t/=2,n>>>=1;return(e+n)/t},s,"global"in a?a.global:this==n)};function g(e,t){for(var n,o=e+"",r=0;r<o.length;)t[f&r]=f&(n^=19*t[f&r])+o.charCodeAt(r++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(n.random(),t),l&&l.exports){l.exports=p;try{d=require("crypto")}catch(e){}}else u&&u.amd&&u(function(){return p})}(this,[],Math,256,0,0,"object"==typeof module&&module,"function"==typeof define&&define);